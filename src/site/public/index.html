<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="description" content="Solve captchas for Epic Games actions">
    <meta name="author" content="Charlie Laabs">
    <title>Epic Games Captcha Solve</title>

    <!-- <link rel="icon" href="img/favicon.ico" type="image/x-icon"> -->
    <!-- <link rel="apple-touch-icon" href="img/apple-192.png"> -->
    <meta name="theme-color" content="#202020" />

    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            color: white;
            background-color: rgb(32, 32, 32);
        }
    </style>
    <script src="https://epic-games-api.arkoselabs.com/fc/api/?onload=loadChallenge" async defer></script>
</head>

<body>
    <h2>Solve the Captcha below</h2>
    <div id="CAPTCHA"></div>
    <div id="success-text" style="color: green" hidden>
        <h3>Successfully fulfilled Captcha</h3>
        <p>(Sometimes just opening this page is all you have to do)</p>
    </div>
    <h3>After solving, you may receive more Captcha emails</h3>
    <script>
        const params = new URLSearchParams(document.location.search);
        const pkey = params.get("pkey") || '37D033EB-6489-3763-2AE1-A228C04103F5';
        const id = params.get("id");
        console.info('pkey:', pkey);
        console.info('id:', id);
        function loadChallenge() {
            new FunCaptcha({
                public_key: pkey,
                target_html: "CAPTCHA",
                callback: async (sessionData) => {
                    console.log("Captcha sessionData:", sessionData);
                    const postPath = `${window.location.pathname}/solve`.replace(/\/+/g, '/');
                    const resp = await fetch(postPath, {
                        method: 'post',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            sessionData,
                            id
                        })
                    });
                    if (resp.ok) {
                        console.log("Successfully sent Captcha token");
                        document.getElementById("success-text").hidden = false;
                    }
                    else console.error("Failed sending Captcha token");

                }
            });
        }
    </script>
    <noscript>Javascript is required to use this application</noscript>
</body>

</html>